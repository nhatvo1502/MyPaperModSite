<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Using Google SDM API to control Google Nest Camera | nathaniel</title>
<meta name="keywords" content="">
<meta name="description" content="Project name: Croddy
Nest Camera Guide: https://developers.google.com/nest/device-access/get-started Register Device Access Accept $5 one time fee https://console.nest.google.com/device-access/ Activate Supported Device Activate and setup device with non-commercial google account Setup Google Cloud Platform Use the link on top of the article, scroll down to Setup Google Cloud Platform and click on Enable the API and Get an OAuth 2.0 Client ID Select Webserver &gt; Enter https://www.google.com &gt; copy Client ID and download the file Create a Device Access project Go to Device Access &gt; Create new project &gt; paste Client ID &gt; disable event Once done, copy Project ID down Now you have to link your developer account with user account">
<meta name="author" content="Nhat Vo">
<link rel="canonical" href="http://www.nvo.one/posts/005-google-sdm/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.4599eadb9eb2ad3d0a8d6827b41a8fda8f2f4af226b63466c09c5fddbc8706b7.css" integrity="sha256-RZnq256yrT0KjWgntBqP2o8vSvImtjRmwJxf3byHBrc=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://www.nvo.one/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://www.nvo.one/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://www.nvo.one/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://www.nvo.one/apple-touch-icon.png">
<link rel="mask-icon" href="http://www.nvo.one/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="Using Google SDM API to control Google Nest Camera" />
<meta property="og:description" content="Project name: Croddy
Nest Camera Guide: https://developers.google.com/nest/device-access/get-started Register Device Access Accept $5 one time fee https://console.nest.google.com/device-access/ Activate Supported Device Activate and setup device with non-commercial google account Setup Google Cloud Platform Use the link on top of the article, scroll down to Setup Google Cloud Platform and click on Enable the API and Get an OAuth 2.0 Client ID Select Webserver &gt; Enter https://www.google.com &gt; copy Client ID and download the file Create a Device Access project Go to Device Access &gt; Create new project &gt; paste Client ID &gt; disable event Once done, copy Project ID down Now you have to link your developer account with user account" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.nvo.one/posts/005-google-sdm/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-18T11:55:37-08:00" />
<meta property="article:modified_time" content="2024-01-18T11:55:37-08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Using Google SDM API to control Google Nest Camera"/>
<meta name="twitter:description" content="Project name: Croddy
Nest Camera Guide: https://developers.google.com/nest/device-access/get-started Register Device Access Accept $5 one time fee https://console.nest.google.com/device-access/ Activate Supported Device Activate and setup device with non-commercial google account Setup Google Cloud Platform Use the link on top of the article, scroll down to Setup Google Cloud Platform and click on Enable the API and Get an OAuth 2.0 Client ID Select Webserver &gt; Enter https://www.google.com &gt; copy Client ID and download the file Create a Device Access project Go to Device Access &gt; Create new project &gt; paste Client ID &gt; disable event Once done, copy Project ID down Now you have to link your developer account with user account"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://www.nvo.one/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Using Google SDM API to control Google Nest Camera",
      "item": "http://www.nvo.one/posts/005-google-sdm/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Using Google SDM API to control Google Nest Camera",
  "name": "Using Google SDM API to control Google Nest Camera",
  "description": "Project name: Croddy\nNest Camera Guide: https://developers.google.com/nest/device-access/get-started Register Device Access Accept $5 one time fee https://console.nest.google.com/device-access/ Activate Supported Device Activate and setup device with non-commercial google account Setup Google Cloud Platform Use the link on top of the article, scroll down to Setup Google Cloud Platform and click on Enable the API and Get an OAuth 2.0 Client ID Select Webserver \u0026gt; Enter https://www.google.com \u0026gt; copy Client ID and download the file Create a Device Access project Go to Device Access \u0026gt; Create new project \u0026gt; paste Client ID \u0026gt; disable event Once done, copy Project ID down Now you have to link your developer account with user account",
  "keywords": [
    
  ],
  "articleBody": "Project name: Croddy\nNest Camera Guide: https://developers.google.com/nest/device-access/get-started Register Device Access Accept $5 one time fee https://console.nest.google.com/device-access/ Activate Supported Device Activate and setup device with non-commercial google account Setup Google Cloud Platform Use the link on top of the article, scroll down to Setup Google Cloud Platform and click on Enable the API and Get an OAuth 2.0 Client ID Select Webserver \u003e Enter https://www.google.com \u003e copy Client ID and download the file Create a Device Access project Go to Device Access \u003e Create new project \u003e paste Client ID \u003e disable event Once done, copy Project ID down Now you have to link your developer account with user account\nLink your account PCM - Get Authorization Code https://nestservices.google.com/partnerconnections/project-id/auth?redirect_uri=https://www.google.com\u0026access_type=offline\u0026prompt=consent\u0026client_id=oauth2-client-id\u0026response_type=code\u0026scope=https://www.googleapis.com/auth/sdm.service Go to Google Cloud Platform \u003e OAuth consent screen \u003e Under Test User \u003e add yourself in replace project-id (from Device Access Project ID) replace oath2-client-id with OAuthClient ID from Google Cloud Crendetial Copy and paste to google Allow and follow next Once done, it will go to www.google.com, copy the URL The Authorization code is in the URL: https://www.google.com/?code=4/0AfJohXlvngYWOp06a-e68hfU7jEOyrMeUyPlA2AVfs-og4i172VeEBzLLgP7UsiWxGkXrA\u0026scope=https://www.googleapis.com/auth/sdm.service the code start after code= and end \u0026scope Get Access Token Open terminal, replace oauth2-client-id with the OAuth2 Client ID from your Google Cloud Credentials oauth2-client-secret with Client Secret from your Google Cloud Credentials authorization-code with the code you received in the previous stepvariable and run curl -L -X POST 'https://www.googleapis.com/oauth2/v4/token?client_id=oauth2-client-id\u0026client_secret=oauth2-client-secret\u0026code=authorization-code\u0026grant_type=authorization_code\u0026redirect_uri=https://www.google.com' if it give you error, run Remove-item alias:curl if it gives you Error 411 (Length Required), add this to the end of your curl -H 'Content-Length: 0' it should return 2 tokens: access token and refresh token { \"access_token\": \"access-token\", \"expires_in\": 3599, \"refresh_token\": \"refresh-token\", \"scope\": \"https://www.googleapis.com/auth/sdm.service\", \"token_type\": \"Bearer\" } Make a device list call IMPORTANT: This call is required to complete the authorization, with out this call, the authorization project will not appear in PCM and events will not be published curl -X GET 'https://smartdevicemanagement.googleapis.com/v1/enterprises/project-id/devices' \\ -H 'Content-Type: application/json' \\ -H 'Authorization: Bearer access-token' Replace project-id with Project ID find in Deviec Access console Replace access-token with Access Token from step 6 remove space and \\ to make the curl into one line copy and paste into terminal result { \"devices\": [ { \"name\": \"enterprises/project-id/devices/device-id\", \"type\": \"sdm.devices.types.device-type\", \"traits\": { ... }, \"parentRelations\": [ { \"parent\": \"enterprises/project-id/structures/structure-id/rooms/room-id\", \"displayName\": \"device-room-name\" } ] } ] } ",
  "wordCount" : "382",
  "inLanguage": "en",
  "datePublished": "2024-01-18T11:55:37-08:00",
  "dateModified": "2024-01-18T11:55:37-08:00",
  "author":{
    "@type": "Person",
    "name": "Nhat Vo"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://www.nvo.one/posts/005-google-sdm/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "nathaniel",
    "logo": {
      "@type": "ImageObject",
      "url": "http://www.nvo.one/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://www.nvo.one/" accesskey="h" title="nathaniel (Alt + H)">nathaniel</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://www.nvo.one/posts/about-me" title="about me">
                    <span>about me</span>
                </a>
            </li>
            <li>
                <a href="http://www.nvo.one/posts" title="posts">
                    <span>posts</span>
                </a>
            </li>
            <li>
                <a href="http://www.nvo.one/categories" title="categories">
                    <span>categories</span>
                </a>
            </li>
            <li>
                <a href="http://www.nvo.one/posts/search" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://www.nvo.one/">Home</a>&nbsp;»&nbsp;<a href="http://www.nvo.one/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Using Google SDM API to control Google Nest Camera
    </h1>
    <div class="post-meta"><span title='2024-01-18 11:55:37 -0800 PST'>January 18, 2024</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Nhat Vo

</div>
  </header> 

  <div class="post-content"><p>Project name: Croddy</p>
<ul>
<li>Nest Camera</li>
</ul>
<pre tabindex="0"><code>Guide: https://developers.google.com/nest/device-access/get-started
</code></pre><ol>
<li>Register Device Access</li>
</ol>
<ul>
<li>Accept $5 one time fee</li>
</ul>
<pre tabindex="0"><code>https://console.nest.google.com/device-access/
</code></pre><ol start="2">
<li>Activate Supported Device</li>
</ol>
<ul>
<li>Activate and setup device with non-commercial google account</li>
</ul>
<ol start="3">
<li>Setup Google Cloud Platform</li>
</ol>
<ul>
<li>Use the link on top of the article, scroll down to Setup Google Cloud Platform and click on Enable the API and Get an OAuth 2.0 Client ID</li>
<li>Select Webserver &gt; Enter <em><a href="https://www.google.com">https://www.google.com</a></em> &gt; copy Client ID and download the file</li>
</ul>
<ol start="4">
<li>Create a Device Access project</li>
</ol>
<ul>
<li>Go to Device Access &gt; Create new project &gt; paste Client ID &gt; disable event</li>
<li>Once done, copy Project ID down</li>
</ul>
<p>Now you have to link your developer account with user account</p>
<ol start="5">
<li>Link your account PCM - Get Authorization Code</li>
</ol>
<pre tabindex="0"><code>https://nestservices.google.com/partnerconnections/project-id/auth?redirect_uri=https://www.google.com&amp;access_type=offline&amp;prompt=consent&amp;client_id=oauth2-client-id&amp;response_type=code&amp;scope=https://www.googleapis.com/auth/sdm.service
</code></pre><ul>
<li>Go to Google Cloud Platform &gt; OAuth consent screen &gt; Under Test User &gt; add yourself in</li>
<li>replace project-id (from Device Access Project ID)</li>
<li>replace oath2-client-id with OAuthClient ID from Google Cloud Crendetial</li>
<li>Copy and paste to google</li>
<li>Allow and follow next</li>
<li>Once done, it will go to <a href="https://www.google.com">www.google.com</a>, copy the URL</li>
<li>The Authorization code is in the URL:</li>
</ul>
<pre tabindex="0"><code>https://www.google.com/?code=4/0AfJohXlvngYWOp06a-e68hfU7jEOyrMeUyPlA2AVfs-og4i172VeEBzLLgP7UsiWxGkXrA&amp;scope=https://www.googleapis.com/auth/sdm.service
</code></pre><ul>
<li>the code start after code= and end &amp;scope</li>
</ul>
<ol start="6">
<li>Get Access Token</li>
</ol>
<ul>
<li>Open terminal, replace
<ul>
<li>oauth2-client-id with the OAuth2 Client ID from your Google Cloud Credentials</li>
<li>oauth2-client-secret with  Client Secret from your Google Cloud Credentials</li>
<li>authorization-code with the code you received in the previous stepvariable and run</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>curl -L -X POST &#39;https://www.googleapis.com/oauth2/v4/token?client_id=oauth2-client-id&amp;client_secret=oauth2-client-secret&amp;code=authorization-code&amp;grant_type=authorization_code&amp;redirect_uri=https://www.google.com&#39;
</code></pre><ul>
<li>if it give you error, run</li>
</ul>
<pre tabindex="0"><code>Remove-item alias:curl
</code></pre><ul>
<li>if it gives you Error 411 (Length Required), add this to the end of your curl</li>
</ul>
<pre tabindex="0"><code>-H &#39;Content-Length: 0&#39;
</code></pre><ul>
<li>it should return 2 tokens: access token and refresh token</li>
</ul>
<pre tabindex="0"><code>{
  &#34;access_token&#34;: &#34;access-token&#34;,
  &#34;expires_in&#34;: 3599,
  &#34;refresh_token&#34;: &#34;refresh-token&#34;,
  &#34;scope&#34;: &#34;https://www.googleapis.com/auth/sdm.service&#34;,
  &#34;token_type&#34;: &#34;Bearer&#34;
}
</code></pre><ol start="7">
<li>Make a device list call
IMPORTANT: This call is required to complete the authorization, with out this call, the authorization project will not appear in PCM and events will not be published</li>
</ol>
<pre tabindex="0"><code>curl -X GET &#39;https://smartdevicemanagement.googleapis.com/v1/enterprises/project-id/devices&#39; \
    -H &#39;Content-Type: application/json&#39; \
    -H &#39;Authorization: Bearer access-token&#39;
</code></pre><ul>
<li>Replace <em>project-id</em> with Project ID find in Deviec Access console</li>
<li>Replace <em>access-token</em> with Access Token from step 6</li>
<li>remove space and \ to make the curl into one line</li>
<li>copy and paste into terminal</li>
<li>result</li>
</ul>
<pre tabindex="0"><code>{
  &#34;devices&#34;: [
    {
      &#34;name&#34;: &#34;enterprises/project-id/devices/device-id&#34;,
      &#34;type&#34;: &#34;sdm.devices.types.device-type&#34;,
      &#34;traits&#34;: { ... },
      &#34;parentRelations&#34;: [
        {
          &#34;parent&#34;: &#34;enterprises/project-id/structures/structure-id/rooms/room-id&#34;,
          &#34;displayName&#34;: &#34;device-room-name&#34;
        }
      ]
    }
  ]
}
</code></pre><ul>
<li></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer><div id="disqus_thread"></div>
<script>
    

    

    (function() { 
    var d = document, s = d.createElement('script');
    s.src = 'https://www-nvo-one.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://www.nvo.one/">nathaniel</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
